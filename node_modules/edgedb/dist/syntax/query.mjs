import * as edgedb from "edgedb";
import { Cardinality } from "../reflection";
async function queryFunc(cxn, args) {
    if (this.__cardinality__ === Cardinality.One ||
        this.__cardinality__ === Cardinality.AtMostOne) {
        let result;
        try {
            result = await cxn.querySingle(this.toEdgeQL(), args);
        }
        catch (err) {
            if (err instanceof edgedb.NoDataError) {
                result = null;
            }
            else {
                throw err;
            }
        }
        return result;
    }
    else {
        return cxn.query(this.toEdgeQL(), args);
    }
}
export function $queryify(expr) {
    return Object.assign(expr, {
        run: queryFunc.bind(expr),
    });
}
