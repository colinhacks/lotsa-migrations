"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.withParams = exports.optional = void 0;
const reflection_1 = require("../reflection");
const path_1 = require("./path");
const query_1 = require("./query");
function optional(type) {
    return {
        __kind__: reflection_1.ExpressionKind.OptionalParam,
        __type__: type,
    };
}
exports.optional = optional;
function withParams(params, expr) {
    const paramExprs = {};
    for (const [key, param] of Object.entries(params)) {
        paramExprs[key] = (0, path_1.$expressionify)({
            __kind__: reflection_1.ExpressionKind.Param,
            __element__: param.__kind__ === reflection_1.ExpressionKind.OptionalParam
                ? param.__type__
                : param,
            __cardinality__: param.__kind__ === reflection_1.ExpressionKind.OptionalParam
                ? reflection_1.Cardinality.AtMostOne
                : reflection_1.Cardinality.One,
            __name__: key,
        });
    }
    const returnExpr = expr(paramExprs);
    return (0, path_1.$expressionify)((0, query_1.$queryify)({
        __kind__: reflection_1.ExpressionKind.WithParams,
        __element__: returnExpr.__element__,
        __cardinality__: returnExpr.__cardinality__,
        __expr__: returnExpr,
    }));
}
exports.withParams = withParams;
